{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';// Import useNavigate\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='http://localhost:5000/api';const getAuthToken=()=>localStorage.getItem('token');const API_KEY=process.env.WEATHER_API_KEY;// Your OpenWeatherMap API Key\nconst Profile=()=>{// Removed onNavigate prop\nconst navigate=useNavigate();// Initialize useNavigate hook\nconst[fullName,setFullName]=useState('');const[emailAddress,setEmailAddress]=useState('');const[location,setLocation]=useState('');const[emailNotifications,setEmailNotifications]=useState(true);const[pushNotifications,setPushNotifications]=useState(false);// States for weather information\nconst[weatherData,setWeatherData]=useState(null);const[weatherLoading,setWeatherLoading]=useState(false);const[weatherError,setWeatherError]=useState('');// A ref to hold the debounce timer\nconst debounceTimeout=useRef(null);// Effect to load initial user data from localStorage and then fetch from backend\nuseEffect(()=>{// 1. Load from localStorage for immediate display\nconst storedUser=localStorage.getItem('currentUser');if(storedUser){const user=JSON.parse(storedUser);setFullName(user.name||'');setEmailAddress(user.email||'');setLocation(user.city||'');setEmailNotifications(user.emailNotifications||false);}// 2. Fetch fresh data from the backend\nconst fetchUserProfile=async()=>{try{const token=getAuthToken();if(!token)return;const response=await axios.get(`${API_BASE_URL}/profile`,{headers:{'x-auth-token':token}});const user=response.data;setFullName(user.name||'');setEmailAddress(user.email||'');setLocation(user.city||'');setEmailNotifications(user.emailNotifications||false);// Update localStorage with the latest data\nlocalStorage.setItem('currentUser',JSON.stringify(user));}catch(err){console.error(\"Error fetching profile:\",err);}};fetchUserProfile();},[]);const fetchWeather=async city=>{setWeatherLoading(true);setWeatherError('');try{const encodedCity=encodeURIComponent(city);const weatherApiUrl=`https://api.openweathermap.org/data/2.5/weather?q=${encodedCity}&appid=${API_KEY}&units=metric`;const response=await axios.get(weatherApiUrl);const data=response.data;if(data&&data.weather&&data.main){setWeatherData({temperature:Math.round(data.main.temp),description:data.weather[0].description,icon:data.weather[0].icon,city:data.name});}else{setWeatherError('Could not retrieve weather data for this location.');setWeatherData(null);}}catch(error){var _error$response,_error$response$data;console.error('Error fetching weather data:',error);setWeatherError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to fetch weather data. Please try a different location.');setWeatherData(null);}finally{setWeatherLoading(false);}};const saveProfileChanges=async updates=>{try{const token=getAuthToken();if(!token)return;const response=await axios.put(`${API_BASE_URL}/profile`,updates,{headers:{'x-auth-token':token}});// Update local storage with the new data from the response\nlocalStorage.setItem('currentUser',JSON.stringify(response.data));}catch(err){console.error('Failed to save profile changes:',err);}};// Debounced effect to fetch weather and save location changes\nuseEffect(()=>{// Clear any previous timer\nif(debounceTimeout.current){clearTimeout(debounceTimeout.current);}// Only proceed if location is not empty\nif(location){// Set a new timer to fetch weather and save changes after 500ms\ndebounceTimeout.current=setTimeout(()=>{fetchWeather(location);saveProfileChanges({city:location});},500);}else{setWeatherData(null);}// Cleanup function to clear the timer on component unmount or dependency change\nreturn()=>{if(debounceTimeout.current){clearTimeout(debounceTimeout.current);}};},[location]);// Handle saving of the full name\nconst handleFullNameChange=e=>{const newName=e.target.value;setFullName(newName);// You can add a debounce here as well if you want\nsaveProfileChanges({name:newName});};// Handle email notification toggle\nconst handleEmailNotificationsToggle=async()=>{const newValue=!emailNotifications;setEmailNotifications(newValue);saveProfileChanges({emailNotifications:newValue});};return/*#__PURE__*/_jsxs(\"div\",{style:styles.profileContainer,children:[/*#__PURE__*/_jsx(\"style\",{children:`\n          /* Inline styles specific to this Profile page content */\n          .form-label {\n            font-weight: 500;\n            color: #555;\n          }\n          .form-text {\n            font-size: 0.85rem;\n            color: #777;\n          }\n          .alert {\n            border-radius: 8px;\n            margin-bottom: 1.5rem;\n          }\n          .alert-success {\n            background-color: #d4edda;\n            color: #155724;\n            border-color: #c3e6cb;\n          }\n          .alert-danger {\n            background-color: #f8d7da;\n            color: #721c24;\n            border-color: #f5c6cb;\n          }\n          /* Custom styling for the Bootstrap switch toggle */\n          .form-check-input:checked {\n            background-color: #4CAF50; /* Green when checked */\n            border-color: #4CAF50;\n          }\n          .form-check-input:focus {\n            box-shadow: 0 0 0 0.25rem rgba(76, 175, 80, 0.25); /* Green focus ring */\n          }\n          /* Weather card hover animation */\n          .weather-card:hover {\n            transform: scale(1.02);\n            box-shadow: 0 12px 24px rgba(0,0,0,0.12);\n          }\n        `}),/*#__PURE__*/_jsx(\"div\",{className:\"container pt-2 pb-4 d-flex justify-content-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card shadow-sm\",style:styles.card,children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-4\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-cog fa-3x\",style:styles.icon}),/*#__PURE__*/_jsx(\"h2\",{className:\"mt-3 mb-1\",style:styles.headerText,children:\"Manage Your Account\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Update your profile information and notification preferences.\"})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"mb-4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-2\",style:styles.sectionHeader,children:\"Profile Settings\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-3\",children:\"Keep your information up to date.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"fullName\",className:\"form-label\",children:\"Full Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",id:\"fullName\",value:fullName,readOnly:true,onChange:handleFullNameChange,style:styles.inputField})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"emailAddress\",className:\"form-label\",children:\"Email Address\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",className:\"form-control\",id:\"emailAddress\",value:emailAddress,readOnly:true,style:styles.inputField}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-text mt-1\",children:[\"Your email address cannot be changed here.\",/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/contact')// Changed to navigate('/contact')\n,style:{background:'none',border:'none',padding:0,color:styles.link.color,textDecoration:'none',cursor:'pointer',display:'inline'},children:\"Contact support\"}),\" to change it.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"location\",className:\"form-label\",children:\"Location (City)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",id:\"location\",value:location,onChange:e=>setLocation(e.target.value),style:styles.inputField}),/*#__PURE__*/_jsx(\"div\",{className:\"form-text mt-1\",children:\"Enter a city to get a real-time weather update.\"})]})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"mb-4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-2\",style:styles.sectionHeader,children:\"Current Weather\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-3\",children:\"Get real-time weather updates for your location.\"}),weatherLoading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:\"Loading weather...\"}):weatherError?/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger text-center\",role:\"alert\",children:weatherError}):weatherData?/*#__PURE__*/_jsxs(\"div\",{className:\"weather-card d-flex align-items-center justify-content-center\",style:styles.weatherCard,children:[/*#__PURE__*/_jsx(\"img\",{src:`http://openweathermap.org/img/wn/${weatherData.icon}@2x.png`,alt:weatherData.description,style:{width:'80px',height:'80px'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"ms-4 text-center\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"mb-0\",style:{color:styles.headerText.color,fontSize:'2.5rem'},children:[weatherData.temperature,\"\\xB0C\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0 text-muted\",style:{textTransform:'capitalize',fontSize:'1rem'},children:weatherData.description}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0 text-muted small\",children:weatherData.city})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-muted\",children:\"No weather data available. Please enter a location.\"})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"mb-4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-2\",style:styles.sectionHeader,children:\"Notification Preferences\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-3 p-3 rounded\",style:styles.notificationToggleContainer,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:\"Email Notifications\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",style:styles.notificationDescription,children:\"Receive important updates and plant care reminders via email.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-check form-switch\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",id:\"emailNotifications\",checked:emailNotifications,onChange:handleEmailNotificationsToggle,style:styles.toggleSwitch}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"emailNotifications\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-3 p-3 rounded\",style:styles.notificationToggleContainer,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:\"Push Notifications\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",style:styles.notificationDescription,children:\"Get instant alerts on your device (if app installed).\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-check form-switch\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",id:\"pushNotifications\",checked:pushNotifications,onChange:()=>setPushNotifications(!pushNotifications),style:styles.toggleSwitch}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"pushNotifications\"})]})]})]})]})})})]});};// Inline styles for the component to match the image\nconst styles={profileContainer:{minHeight:'calc(100vh - 90px)',paddingTop:'20px',backgroundColor:'var(--background)',fontFamily:'\"Inter\", sans-serif',display:'flex',justifyContent:'center',alignItems:'flex-start'},card:{width:'100%',maxWidth:'600px',borderRadius:'15px',backgroundColor:'#FCF8E3',border:'none',marginTop:'0.5rem',marginBottom:'2rem'},icon:{color:'#8BC34A'},headerText:{color:'#4CAF50'},sectionHeader:{color:'#689F38'},inputField:{backgroundColor:'#F9F7E8',borderRadius:'8px',border:'1px solid #E0E0E0',padding:'10px 15px'},link:{color:'#8BC34A',textDecoration:'none'},notificationToggleContainer:{backgroundColor:'#F9F7E8',borderRadius:'10px',border:'1px solid #E0E0E0'},notificationDescription:{fontSize:'0.9rem'},toggleSwitch:{'--bs-form-switch-bg':'url(\"data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%27-4 -4 8 8%27%3e%3ccircle r=%273%27 fill=%27%23fff%27/%3e%3c/svg%3e\") !important',backgroundColor:'#D1E7DD',borderColor:'#28A745',width:'3.5rem',height:'2rem'},weatherCard:{background:'linear-gradient(135deg, #f5f5dc 0%, #e6f4ea 100%)',backdropFilter:'blur(5px)',borderRadius:'16px',padding:'20px 30px',boxShadow:'0 8px 20px rgba(0,0,0,0.1)',display:'flex',alignItems:'center',justifyContent:'center',transition:'transform 0.3s ease',border:'1px solid rgba(200,200,200,0.4)'}};export default Profile;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}